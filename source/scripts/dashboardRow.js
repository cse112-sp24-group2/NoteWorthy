import{initializeDB as i,getNotesFromStorage as s,saveNoteToStorage as a}from"./noteStorage.js";import{deleteNote as d}from"./noteFunctions.js";import{updateURL as r}from"./Routing.js";import{addNotesToDocument as c}from"./notesDashboard.js";import{toggleClassToArr as t}from"./utility.js";const e=document.getElementById("dashboard-note-template");class o extends HTMLElement{constructor(){super(),this.flipped=!1,this.animation=!1;var t=this.attachShadow({mode:"open"}),o=(this.shadowRoot.appendChild(e.content.cloneNode(!0)),this.dom=this.fetchElementsFromDOM(),document.createElement("div"));o.setAttribute("class","note"),t.append(o)}fetchElementsFromDOM(){return{noteWrapper:this.shadowRoot.querySelector(".note-wrapper"),noteFront:this.shadowRoot.querySelector(".note-front"),noteBack:this.shadowRoot.querySelector(".note-back"),title:this.shadowRoot.querySelector(".note-title"),content:this.shadowRoot.querySelector(".note-text"),copyButton:this.shadowRoot.querySelector(".note-copy-button"),lastModified:this.shadowRoot.querySelector(".note-last-modified"),noteMore:this.shadowRoot.querySelector(".note-more"),downloadBtn:this.shadowRoot.querySelector(".note-download-button"),copyBtn:this.shadowRoot.querySelector(".note-copy-button"),deleteBtn:this.shadowRoot.querySelector(".note-delete-button"),backBtn:this.shadowRoot.querySelector(".note-back-button")}}set note(o){var t=document.createTextNode(o.title),e=document.createTextNode(o.lastModified),n=o.htmlContent,t=(this.dom.title.replaceChildren(t),this.dom.lastModified.replaceChildren(e),this.dom.content.innerHTML=n,this.dom.deleteBtn.addEventListener("click",async t=>{t.stopPropagation(),d(o.uuid)}),this.dom.copyButton.addEventListener("click",async t=>{t.stopPropagation(),async function(t){var o=await i(indexedDB),e={...t},t=(e.title=t.title+" (copy)",e.uuid=Date.now(),e.lastModified=(new Date).toLocaleString(),a(o,e),await s(o));c(t)}(o)}),t=>{t.stopPropagation(),this.flipNote()});this.dom.backBtn.onclick=t,this.dom.noteMore.onclick=t,this.dom.noteFront.onclick=()=>r("?id="+o.uuid)}flipNote(){this.animation||(t([this.dom.noteFront,this.dom.noteBack],"transition-action"),this.animation=!0),t([this.dom.noteFront,this.dom.noteBack],"flipped"),this.flipped=!this.flipped}}customElements.define("dashboard-row",o);