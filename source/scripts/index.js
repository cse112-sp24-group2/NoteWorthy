import{pageData as a,updateURL as o}from"./Routing.js";import{initializeDB as e,getNotesFromStorage as r,getNoteFromStorage as n}from"./noteStorage.js";import{editNote as i,addNoteToDocument as d,initEditor as t}from"./notesEditor.js";import{initializeTagDB as s,getTagsFromStorage as c}from"./tagStorage.js";import{initTagSearch as l,addTagsToDocument as u}from"./sidebar.js";import{getDate as m,toggleClassToArr as g}from"./utility.js";import{addNotesToDocument as y,initTimeColumnSorting as S,initTitleColumnSorting as h,initSearchBar as w}from"./notesDashboard.js";import{initSettings as b}from"./settings.js";function p(){var e=new URLSearchParams(window.location.search).get("id"),t=("9999"===e||null==e?(a.noteID=null,a.tags=[]):a.noteID=parseInt(e,10),{editor:document.querySelector(".editor"),dashboard:document.querySelector(".dashboard")});null==e?(async function(e){var t=a.database,t=await r(t);y(t),e.editor.classList.add("hidden"),e.dashboard.classList.remove("hidden")}(t),document.getElementById("notes-tags").innerHTML=""):async function(e,t){var o;9999!==e?(o=a.database,o=await n(o,e),a.editEnabled=!1,d(o)):(e={title:"",lastModified:""+m(),tags:[],content:""},await d(e),i(!0)),t.editor.classList.remove("hidden"),t.dashboard.classList.add("hidden")}(parseInt(e,10),t)}function D(){const t=document.querySelector("#darkMode");t.addEventListener("click",()=>{t.textContent=document.body.classList.contains("dark")?"Light":"Dark";var e=[document.body,document.querySelector(".sidebar"),document.querySelector("#tags"),document.querySelector("#view-more"),document.querySelector(".dashboard-header"),document.querySelector("#sort"),document.querySelector(".searchbar-wrapper"),document.querySelector(".empty-dashboard"),document.querySelector(".view"),document.querySelector(".editor"),document.querySelector("#notes-title"),document.querySelector("#title-input"),document.querySelector(".note-control-bar")];g(e,"dark")})}window.addEventListener("DOMContentLoaded",async function(){document.querySelector("#newNote").addEventListener("click",()=>o("?id=9999")),console.log("%cWelcome to %cNoteWorthy. ","","color: #D4C1EC; font-weight: bolder; font-size: 0.8rem",""),a.database=await e(indexedDB),a.tagDB=await s(indexedDB),a.tags=await c(a.tagDB),async function(){var e=a.database,e=await r(e);console.log("the pageData.tags is",a.tags),u(a.tags),S(e),h(e),w(e),l(),D(),document.querySelector(".header > h1").addEventListener("click",async()=>o(""));let t=window.location.search;window.addEventListener("popstate",()=>{var e=window.location.search;e!==t&&(t=e,p())})}(),b(),p(),t()});