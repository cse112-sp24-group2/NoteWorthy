import{updateURL as c,pageData as u}from"./Routing.js";import{saveNoteToStorage as m,getNotesFromStorage as g}from"./noteStorage.js";import{getDate as p}from"./utility.js";import{exportNote as r,deleteNote as d}from"./noteFunctions.js";import{saveTagToStorage as y}from"./tagStorage.js";import{alertDialog as h}from"./settings.js";let b;async function i(e){var t=document.querySelector("#notes-title"),n=document.querySelector("#notes-last-modified"),o=document.getElementById("notes-tags");t.innerHTML=`<input type="text"
    ${t.classList.contains("dark")?'class="dark"':'class=""'} id="title-input" placeholder="Untitled Note">`,document.querySelector("#title-input").value=e.title,n.innerHTML="Last Modified: "+e.lastModified,b.setContents(e.content);document.querySelector("#tag-input").setAttribute("placeholder","Add tag...");var a=e.tags;for(let e=0;e<a.length;e+=1){var l=document.createElement("input"),l=(console.log(a[e]),l.type="checkbox",l.className="tag",l.name=a[e],l.checked=!0,o.appendChild(l),document.createElement("label"));l.htmlFor=a[e],l.appendChild(document.createTextNode(a[e])),o.appendChild(l)}}function s(e){var t=document.querySelector("#export-button"),n=document.querySelector("#import-button"),o=document.querySelector("#tag-button"),a=document.querySelector("#tag-input"),l=document.querySelectorAll("input[type=checkbox]");const c=e||!u.editEnabled;u.editEnabled=c;e=(e,t)=>{e.disabled=!t,e.classList.toggle("disabled-button",!t)};const r=(e,t)=>{e.disabled=!t,e.classList.toggle("disabled-button",!t)};e(t,!c),e(n,!c),e(o,c),r(a,c),l.forEach(e=>{r(e,c)})}function f(){var e,t,n,o,a=u.database,l=u.noteID,c=u.tagDB,r=function(){var t=document.getElementById("notes-tags").elements,n=[];for(let e=0;e<t.length;e+=1){var o=t[e];"checkbox"===o.type&&!0===o.checked&&n.push(o.name)}return n}(),d=(d=r,e=l,""===(o=document.querySelector("#title-input").value.replace(/\s+/g," ").trim())?(h("Please enter a valid title"),null):(t=b.getContents(),n=b.getSemanticHTML(),o={title:o,lastModified:p(),tags:d,content:t,htmlContent:n},e&&(o.uuid=e),o));if(!d||null==d)return!1;m(a,d),l||g(a).then(e=>{u.noteID=e[e.length-1].uuid});var i=document.querySelectorAll("#tag");for(let e=0;e<i.length;e+=1)i[e].classList.add("disabled-button"),i[e].disabled=!1;for(let e=0;e<r.length;e+=1){var s={tag_name:r[e],num_notes:1};y(c,s)}return!0}async function e(){var e=document.querySelector("#delete-button"),t=document.querySelector("#back-button"),n=document.querySelector("#tag-button"),o=document.querySelector("#export-button"),a=document.querySelector("#import-button"),l=document.querySelector("#notes-content");b=new Quill("#editor",{theme:"snow"}),l.addEventListener("click",()=>s(!0)),e.addEventListener("click",()=>d()),t.addEventListener("click",()=>{f()&&c("")}),n.addEventListener("click",()=>async function(){var e,t,n=document.querySelector("#tag-input").value.replace(/\s+/g," ").trim();if(""===n)h("Please enter a valid tag name","alert");else{const o=[];document.querySelectorAll(".tag").forEach(e=>{o.push(e.name)}),console.log(o),o.includes(n)?alert("Tag already exists"):(e=document.getElementById("notes-tags"),(t=document.createElement("input")).type="checkbox",t.checked=!0,t.className="tag",t.name=n,e.appendChild(t),(t=document.createElement("label")).htmlFor=n,t.appendChild(document.createTextNode(n)),e.appendChild(t))}}()),o.addEventListener("click",()=>r()),a.addEventListener("click",()=>{{const e=document.createElement("input");e.type="file",e.accept=".txt",e.click(),e.onchange=async()=>{const t=e.files[0],n=new FileReader;n.readAsText(t),n.onload=async()=>{var e=n.result;await i({title:t.name.replace(".txt",""),lastModified:p(),content:e})}}}})}export{i as addNoteToDocument,s as editNote,f as saveNote,e as initEditor};