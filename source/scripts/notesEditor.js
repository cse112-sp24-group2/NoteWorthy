import{updateURL as r,pageData as u}from"./Routing.js";import{saveNoteToStorage as m,getNotesFromStorage as g}from"./noteStorage.js";import{getDate as p}from"./utility.js";import{exportNote as d,deleteNote as i}from"./noteFunctions.js";import{saveTagToStorage as y}from"./tagStorage.js";import{alertDialog as h}from"./settings.js";let b;async function s(e){var t=document.querySelector("#notes-title"),n=document.querySelector("#notes-last-modified"),o=document.getElementById("notes-tags");t.innerHTML=`<input type="text"
    ${t.classList.contains("dark")?'class="dark"':'class=""'} id="title-input" placeholder="Untitled Note">`,document.querySelector("#title-input").value=e.title,n.innerHTML="Last Modified: "+e.lastModified,b.setContents(e.content);document.querySelector("#tag-input").setAttribute("placeholder","Add tag...");var a=e.tags;for(let e=0;e<a.length;e+=1){var l=document.createElement("input"),l=(console.log(a[e]),l.type="checkbox",l.className="tag",l.name=a[e],l.checked=!0,o.appendChild(l),document.createElement("label"));l.htmlFor=a[e],l.appendChild(document.createTextNode(a[e])),o.appendChild(l)}}function v(e){var t=document.querySelector("#export-button"),n=document.querySelector("#import-button"),o=document.querySelector("#save-button"),a=document.querySelector("#tag-button"),l=document.querySelector("#tag-input"),c=document.querySelectorAll("input[type=checkbox]");const r=e||!u.editEnabled;u.editEnabled=r;e=(e,t)=>{e.disabled=!t,e.classList.toggle("disabled-button",!t)};const d=(e,t)=>{e.disabled=!t,e.classList.toggle("disabled-button",!t)};e(t,!r),e(n,!r),e(o,r),e(a,r),d(l,r),c.forEach(e=>{d(e,r)})}function S(){var e,t,n,o,a=u.database,l=u.noteID,c=u.tagDB,r=function(){var t=document.getElementById("notes-tags").elements,n=[];for(let e=0;e<t.length;e+=1){var o=t[e];"checkbox"===o.type&&!0===o.checked&&n.push(o.name)}return n}(),d=(d=r,e=l,""===(o=document.querySelector("#title-input").value.replace(/\s+/g," ").trim())?(h("Please enter a valid title"),null):(t=b.getContents(),n=b.getSemanticHTML(),o={title:o,lastModified:p(),tags:d,content:t,htmlContent:n},e&&(o.uuid=e),o));if(d){m(a,d),l||g(a).then(e=>{window.history.replaceState({},null,"?id="+e[e.length-1].uuid),u.noteID=e[e.length-1].uuid});var i=document.querySelectorAll("#tag");for(let e=0;e<i.length;e+=1)i[e].classList.add("disabled-button"),i[e].disabled=!1;for(let e=0;e<r.length;e+=1){var s={tag_name:r[e],num_notes:1};y(c,s)}}}async function e(){var e=document.querySelector("#delete-button"),t=document.querySelector("#save-button"),n=document.querySelector("#back-button"),o=document.querySelector("#tag-button"),a=document.querySelector("#export-button"),l=document.querySelector("#import-button"),c=document.querySelector("#notes-content");b=new Quill("#editor",{theme:"snow"}),c.addEventListener("click",()=>v(!0)),e.addEventListener("click",()=>i()),t.addEventListener("click",()=>S()),n.addEventListener("click",()=>r("")),o.addEventListener("click",()=>async function(){var e,t,n=document.querySelector("#tag-input").value.replace(/\s+/g," ").trim();if(""===n)h("Please enter a valid tag name","alert");else{const o=[];document.querySelectorAll(".tag").forEach(e=>{o.push(e.name)}),console.log(o),o.includes(n)?alert("Tag already exists"):(e=document.getElementById("notes-tags"),(t=document.createElement("input")).type="checkbox",t.checked=!0,t.className="tag",t.name=n,e.appendChild(t),(t=document.createElement("label")).htmlFor=n,t.appendChild(document.createTextNode(n)),e.appendChild(t))}}()),a.addEventListener("click",()=>d()),l.addEventListener("click",()=>{{const e=document.createElement("input");e.type="file",e.accept=".txt",e.click(),e.onchange=async()=>{const t=e.files[0],n=new FileReader;n.readAsText(t),n.onload=async()=>{var e=n.result;await s({title:t.name.replace(".txt",""),lastModified:p(),content:e})}}}})}export{s as addNoteToDocument,v as editNote,S as saveNote,e as initEditor};