import{updateURL as u,pageData as m}from"./Routing.js";import{saveNoteToStorage as g,getNotesFromStorage as p}from"./noteStorage.js";import{getDate as y}from"./utility.js";import{exportNote as c,deleteNote as r}from"./noteFunctions.js";import{saveTagToStorage as h}from"./tagStorage.js";import{alertDialog as b}from"./settings.js";let f;async function d(e){var t=document.querySelector("#notes-title"),n=document.querySelector("#notes-last-modified"),o=document.getElementById("notes-tags");t.innerHTML=`<input type="text"
    ${t.classList.contains("dark")?'class="dark"':'class=""'} id="title-input" placeholder="Untitled Note">`,document.querySelector("#title-input").value=e.title,n.innerHTML="Last Modified: "+e.lastModified,f.setContents(e.content);document.querySelector("#tag-input").setAttribute("placeholder","Add tag...");var a=e.tags;for(let e=0;e<a.length;e+=1){var l=document.createElement("input"),l=(console.log(a[e]),l.type="checkbox",l.className="tag",l.name=a[e],l.checked=!0,o.appendChild(l),document.createElement("label"));l.htmlFor=a[e],l.appendChild(document.createTextNode(a[e])),o.appendChild(l)}}function i(e){var t=document.querySelector("#export-button"),n=document.querySelector("#import-button"),o=document.querySelector("#tag-button"),a=document.querySelector("#tag-input"),l=document.querySelectorAll("input[type=checkbox]");const c=e||!m.editEnabled;m.editEnabled=c;e=(e,t)=>{e.disabled=!t,e.classList.toggle("disabled-button",!t)};const r=(e,t)=>{e.disabled=!t,e.classList.toggle("disabled-button",!t)};e(t,!c),e(n,!c),e(o,c),r(a,c),l.forEach(e=>{r(e,c)})}function s(){var e,t,n,o,a=m.database,l=m.noteID,c=m.tagDB,r=function(){var t=document.getElementById("notes-tags").elements,n=[];for(let e=0;e<t.length;e+=1){var o=t[e];"checkbox"===o.type&&!0===o.checked&&n.push(o.name)}return n}(),d=(d=r,e=l,""===(o=document.querySelector("#title-input").value.replace(/\s+/g," ").trim())&&1===f.getLength()?(u(""),null):""===o?(b("Please enter a valid title"),null):(t=f.getContents(),n=f.getSemanticHTML(),o={title:o,lastModified:y(),tags:d,content:t,htmlContent:n},e&&(o.uuid=e),o));if(!d||null==d)return!1;g(a,d),l||p(a).then(e=>{m.noteID=e[e.length-1].uuid});var i=document.querySelectorAll("#tag");for(let e=0;e<i.length;e+=1)i[e].classList.add("disabled-button"),i[e].disabled=!1;for(let e=0;e<r.length;e+=1){var s={tag_name:r[e],num_notes:1};h(c,s)}return!0}async function e(){var e=document.querySelector("#delete-button"),t=document.querySelector("#back-button"),n=document.querySelector("#tag-button"),o=document.querySelector("#export-button"),a=document.querySelector("#import-button"),l=document.querySelector("#notes-content");f=new Quill("#editor",{theme:"snow"}),l.addEventListener("click",()=>i(!0)),e.addEventListener("click",()=>r()),t.addEventListener("click",()=>{s()&&u("")}),n.addEventListener("click",()=>async function(){var e,t,n=document.querySelector("#tag-input").value.replace(/\s+/g," ").trim();if(""===n)b("Please enter a valid tag name","alert");else{const o=[];document.querySelectorAll(".tag").forEach(e=>{o.push(e.name)}),console.log(o),o.includes(n)?alert("Tag already exists"):(e=document.getElementById("notes-tags"),(t=document.createElement("input")).type="checkbox",t.checked=!0,t.className="tag",t.name=n,e.appendChild(t),(t=document.createElement("label")).htmlFor=n,t.appendChild(document.createTextNode(n)),e.appendChild(t))}}()),o.addEventListener("click",()=>c()),a.addEventListener("click",()=>{{const e=document.createElement("input");e.type="file",e.accept=".txt",e.click(),e.onchange=async()=>{const t=e.files[0],n=new FileReader;n.readAsText(t),n.onload=async()=>{var e=n.result;await d({title:t.name.replace(".txt",""),lastModified:y(),content:e})}}}})}export{d as addNoteToDocument,i as editNote,s as saveNote,e as initEditor};